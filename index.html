<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Maafkan Aku — Halaman Kecil Untukmu</title>
  <meta name="description" content="Sebuah halaman kecil yang lembut untuk menyampaikan maaf dengan tulus, ringan, dan tanpa beban."> 
  <style>
    :root{
      --bg1:#f5f7fb; --bg2:#fff1f3; --ink:#1f2a44; --muted:#6b7280;
      --accent:#6d83ff; --accent-2:#ff7a99; --ok:#22c55e;
      --card:rgba(255,255,255,.75); --shadow:0 10px 40px rgba(31,42,68,.12);
      --r:22px;
    }
    *{box-sizing:border-box}
    html,body{height:100%; margin:0; padding:0; overflow-x:hidden;}

    body{
      color:var(--ink); 
      font-family:ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: radial-gradient(1200px 800px at 20% 10%, var(--bg2), transparent),
        radial-gradient(1200px 800px at 80% 0%, #e6f4ff, transparent),
        linear-gradient(135deg, var(--bg1), #ffffff);
      background-attachment:fixed;
      overflow:hidden;
      position: relative;
    }

    /* Efek Bintang Berkelap-kelip */
    .stars {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none;
      z-index: 1;
      background: 
        radial-gradient(circle at 20% 30%, rgba(255,255,255,.6) 1px, transparent 0),
        radial-gradient(circle at 70% 10%, rgba(255,255,255,.4) 1px, transparent 0),
        radial-gradient(circle at 40% 80%, rgba(255,255,255,.5) 1px, transparent 0),
        radial-gradient(circle at 90% 60%, rgba(255,255,255,.3) 1px, transparent 0);
      animation: twinkle 6s ease-in-out infinite;
    }

    @keyframes twinkle {
      0%, 100% { opacity: 0.7; }
      50% { opacity: 1; }
    }

    /* Slider shell */
    .app{position:relative; width:100%; height:100vh; z-index:2;}

    .slider{position:relative; width:100%; height:100%;}
    .slides{position:relative; width:100%; height:100%; overflow:hidden}
    .slide{
      position:absolute; inset:0; display:flex; align-items:center; justify-content:center; 
      padding: clamp(18px, 4vw, 36px);
      opacity:0; transform: translateX(40px) scale(.98); 
      transition: opacity .5s ease, transform .6s cubic-bezier(.2,.8,.2,1);
    }
    .slide.active{
      opacity:1; transform:none; z-index:2
    }

    /* Card */
    .card{
      max-width:min(860px, 92vw); width:100%; background:var(--card); box-shadow:var(--shadow); 
      border-radius:var(--r); backdrop-filter: blur(10px) saturate(140%); 
      padding: clamp(22px, 4.5vw, 36px); text-align:center
    }
    h1{
      margin:0 0 10px; font-size: clamp(26px, 4.6vw, 44px); line-height:1.15;
    }
    .lead{
      color:var(--muted); font-size: clamp(16px, 2.3vw, 18px)
    }
    .sp{height:16px}

    /* Animasi Fade In */
    .fade-in {
      opacity: 0;
      transform: translateY(10px);
      transition: opacity 0.8s ease, transform 0.8s ease;
    }
    .slide.active .fade-in {
      opacity: 1;
      transform: translateY(0);
    }

    .btn{
      appearance:none; border:0; background:linear-gradient(135deg, var(--accent), #86a2ff); 
      color:#fff; padding:12px 18px; border-radius:999px; cursor:pointer; 
      font-weight:700; box-shadow:0 8px 24px rgba(109,131,255,.35);
      transition:transform .08s ease; touch-action: manipulation;
    }
    .btn:hover{transform:translateY(-1px)}
    .btn:active{transform:none}

    .btn-ghost{
      background: rgba(109,131,255,.12); color: var(--accent); 
      box-shadow:none; border:1px solid rgba(109,131,255,.25)
    }
    .btn-row{
      display:flex; gap:12px; justify-content:center; flex-wrap:wrap; margin-top:14px
    }

    /* Photo style */
    .polaroid{
      position:relative; display:inline-block; background:#fff; 
      padding:12px 12px 42px; border-radius:14px; box-shadow:var(--shadow)
    }
    .polaroid img{
      width:min(58vw, 340px); height:min(70vw, 420px); object-fit:cover; 
      display:block; border-radius:10px
    }
    .polaroid .cap{
      position:absolute; bottom:10px; left:0; right:0; text-align:center; 
      font-size:13px; color:#7b859f
    }

    /* Efek Goyang Selotip */
    .tape{
      position:absolute; top:-10px; left:50%; 
      transform:rotate(-6deg) translateX(-50%);
      width:120px; height:34px; background:#f9e5a9; opacity:.8; border-radius:6px;
      animation: sway 5s ease-in-out infinite;
    }

    @keyframes sway {
      0%, 100% { transform: rotate(-6deg) translateX(-50%); }
      50% { transform: rotate(-8deg) translateX(-50%); }
    }

    /* Pagination dots */
    .dots{
      position:absolute; left:50%; bottom:16px; transform:translateX(-50%); 
      display:flex; gap:10px; z-index:10
    }
    .dot{
      width:8px; height:8px; border-radius:50%; 
      background:rgba(31,42,68,.25); border:1px solid rgba(0,0,0,.06); 
      cursor:pointer; touch-action: manipulation;
    }
    .dot.active{background:var(--ink)}

    /* Nav arrows */
    .nav{
      position:absolute; top:50%; transform:translateY(-50%); 
      border:0; background:rgba(31,42,68,.65); color:#fff; 
      width:44px; height:44px; border-radius:50%;
      display:flex; align-items:center; justify-content:center; 
      cursor:pointer; z-index:10; box-shadow:0 10px 24px rgba(31,42,68,.25);
      touch-action: manipulation;
    }
    .nav svg{width:20px; height:20px}
    .nav.prev{left:14px}
    .nav.next{right:14px}

    /* Music floating button */
    .music-btn{
      position:fixed; right:16px; bottom:16px; z-index:20; 
      background:rgba(31,42,68,.88); color:#fff; border:0; 
      border-radius:999px; padding:10px 14px;
      display:flex; align-items:center; gap:10px; 
      box-shadow:0 14px 34px rgba(31,42,68,.35); 
      font-weight:700; cursor:pointer; touch-action: manipulation;
    }
    .dot-ind{
      width:10px; height:10px; border-radius:50%; 
      background:#a0a8bf; box-shadow:0 0 0 6px rgba(160,168,191,.2);
    }
    .music-btn.on .dot-ind {
      animation: pulse 1.5s ease-in-out infinite;
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.3); opacity: 0.8; }
    }

    /* WA button (final) */
    .wa{
      background:linear-gradient(135deg,#24d366,#34eb83); 
      color:#073b21; padding:12px 18px; border-radius:999px; 
      font-weight:800; text-decoration:none; display:inline-block
    }

    /* Helper */
    .muted{color:var(--muted)}

    /* Responsive tweaks */
    @media (max-width:640px){
      .nav{display:none}
      .polaroid img{width:min(84vw, 360px); height:min(110vw, 480px)}
      .dots{bottom:12px}
    }

    /* Fallback */
    .noscript-fallback {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
      background: white; color: #1f2a44; display: flex; 
      align-items: center; justify-content: center; z-index: 9999; 
      font-family: sans-serif; flex-direction: column; 
      padding: 20px; text-align: center;
    }
    .noscript-fallback h2 { margin: 0 0 12px; font-size: 24px; }
    .noscript-fallback p { margin: 0 0 16px; color: #6b7280; }
    .noscript-fallback .btn { background: #6d83ff; color: white; padding: 10px 20px; border-radius: 999px; text-decoration: none; }
  </style>
</head>
<body>

  <!-- Efek Bintang -->
  <div class="stars"></div>

  <!-- Aplikasi Utama -->
  <div class="app">
    <div class="slider" aria-roledescription="carousel" aria-label="Halaman permintaan maaf">
      <div class="slides" id="slides"></div>
      <button class="nav prev" id="prevBtn" aria-label="Sebelumnya" title="Sebelumnya">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
      </button>
      <button class="nav next" id="nextBtn" aria-label="Berikutnya" title="Berikutnya">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
      </button>
      <div class="dots" id="dots" aria-label="Navigasi slide"></div>
    </div>

    <!-- Musik -->
    <audio id="bgm" preload="auto" loop>
      <source src="musik.mp3" type="audio/mpeg" />
    </audio>
    <button id="musicToggle" class="music-btn" aria-pressed="false" aria-label="Toggle musik" title="Toggle musik">
      <span class="dot-ind" aria-hidden="true"></span>
      <span id="musicLabel">Musik: OFF</span>
    </button>
  </div>

  <!-- Fallback jika JS dimatikan -->
  <noscript>
    <div class="noscript-fallback">
      <h2>JavaScript Dimatikan</h2>
      <p>Untuk melihat halaman ini, aktifkan JavaScript di browser Anda.</p>
      <a href="https://wa.me/6282143066267" class="btn">💬 Kirim pesan via WhatsApp</a>
    </div>
  </noscript>

  <script>
    // =====================
    // KONFIGURASI
    // =====================
    const CONFIG = {
      waNumber: '6282143066267',
      waText: 'Aku sudah baca halamannya. Boleh ngobrol sebentar?',
      photos: [
        'IMG_5311.jpg',
        'IMG_5737.jpg',
        'IMG_5710.jpg'
      ],
      slides: [
        { type:'text', title:'Hai…', body:'Aku bikin halaman kecil ini untuk menyampaikan sesuatu dengan pelan dan jujur. Bacanya santai ya; aku nggak mau bikin siapa pun merasa berat.' },
        { type:'text', title:'Aku benar‑benar menyesal', body:'Aku sadar sikap dan kata‑kataku sempat melukai kamu. Maafkan aku. Tanpa pembenaran, tanpa memaksa apa pun—aku menyesal, dan aku belajar dari ini.' },
        { type:'photo', body:'Terima kasih sudah jadi bagian dari banyak hal baik. Aku menghargai kamu, selalu.', photoIndex: 0 },
        { type:'text', title:'Tentang kepercayaan', body:'Aku paham kepercayaan itu nggak bisa diminta. Yang bisa kulakukan hanya memperbaiki diri dan menunjukkan lewat tindakan yang konsisten—tanpa banyak janji.' },
        { type:'final', title:'Terima kasih sudah membaca', body:'Kalau suatu saat kamu ingin ngobrol, aku siap mendengar. Kalau belum, tidak apa‑apa—aku tetap menghargai ruangmu.' }
      ]
    };

    // =====================
    // UTILITAS
    // =====================
    const slidesEl = document.getElementById('slides');
    const dotsEl = document.getElementById('dots');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const bgm = document.getElementById('bgm');
    const musicToggle = document.getElementById('musicToggle');
    const musicLabel = document.getElementById('musicLabel');

    let current = 0; 
    let isDragging = false, startX = 0, deltaX = 0; 
    let musicOn = false; 
    let initializedPlay = false;

    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

    function el(tag, attrs={}, html='') {
      const e = document.createElement(tag);
      for (const [k, v] of Object.entries(attrs)) {
        if (k === 'class') e.className = v;
        else if (k === 'style') e.style.cssText = v;
        else if (k !== 'onerror') e.setAttribute(k, v);
      }
      if (html) e.innerHTML = html;
      return e;
    }

    function setMusicUI() {
      musicToggle.setAttribute('aria-pressed', musicOn ? 'true' : 'false');
      musicLabel.textContent = musicOn ? 'Musik: ON' : 'Musik: OFF';
      const dot = musicToggle.querySelector('.dot-ind');
      dot.style.background = musicOn ? '#ff7a99' : '#a0a8bf';
      dot.style.boxShadow = musicOn ? '0 0 0 6px rgba(255,122,153,.25)' : '0 0 0 6px rgba(160,168,191,.2)';
      if (musicOn) {
        musicToggle.classList.add('on');
      } else {
        musicToggle.classList.remove('on');
      }
    }

    async function tryStartMusic() {
      if (initializedPlay) return;
      initializedPlay = true;
      try {
        await bgm.play();
        musicOn = true;
      } catch (e) {
        console.warn("Autoplay diblokir. Tunggu interaksi pengguna.", e);
        musicOn = false;
      }
      setMusicUI();
    }

    function buildSlides() {
      slidesEl.innerHTML = '';
      dotsEl.innerHTML = '';

      CONFIG.slides.forEach((s, i) => {
        const slide = el('section', { class: 'slide', role: 'group', 'aria-roledescription': 'slide', 'aria-label': `Slide ${i+1}` });

        if (s.type === 'text' || s.type === 'final') {
          const card = el('div', { class: 'card' });
          
          if (s.title) {
            const h1 = el('h1', {}, s.title);
            h1.classList.add('fade-in');
            card.appendChild(h1);
          }
          
          const p = el('p', { class: 'lead fade-in' }, s.body);
          card.appendChild(p);

          if (i === 0) {
            const row = el('div', { class: 'btn-row' });
            const start = el('button', { class: 'btn', id: 'startBtn' }, 'Mulai & nyalakan musik ▶️');
            start.addEventListener('click', tryStartMusic);
            row.appendChild(start);
            card.appendChild(el('div', { class: 'sp' }));
            card.appendChild(row);
          }

          if (s.type === 'final') {
            const sp = el('div', { class: 'sp' });
            const wa = el('a', { class: 'wa', id: 'waBtn', target: '_blank', rel: 'noopener' }, '💬 Kalau mau ngobrol sebentar');
            card.appendChild(sp);
            card.appendChild(wa);
          }

          slide.appendChild(card);
        }

        if (s.type === 'photo') {
          const card = el('div', { class: 'card' });
          const wrap = el('div', { style: 'display:flex; flex-direction:column; align-items:center; gap:16px' });
          const pol = el('div', { class: 'polaroid' });
          pol.appendChild(el('div', { class: 'tape' }));

          const src = CONFIG.photos[s.photoIndex ?? 0] || CONFIG.photos[0];
          const img = el('img', { src, alt: 'Foto' });
          img.onerror = () => {
            img.src = 'https://via.placeholder.com/300x400?text=Foto+Tidak+Ditemukan';
          };
          pol.appendChild(img);
          pol.appendChild(el('div', { class: 'cap' }, 'Sebaris kenangan baik'));
          wrap.appendChild(pol);
          wrap.appendChild(el('p', { class: 'lead fade-in' }, s.body));
          card.appendChild(wrap);
          slide.appendChild(card);
        }

        slidesEl.appendChild(slide);

        const dot = el('button', { class: 'dot', 'aria-label': `Ke slide ${i+1}` });
        dot.addEventListener('click', () => go(i));
        dotsEl.appendChild(dot);
      });

      update();

      const waBtn = $('#waBtn');
      if (waBtn) {
        const t = encodeURIComponent(CONFIG.waText || 'Halo');
        waBtn.href = `https://wa.me/${CONFIG.waNumber}?text=${t}`;
      }
    }

    function update() {
      $$('.slide').forEach((n, i) => n.classList.toggle('active', i === current));
      $$('.dot').forEach((d, i) => {
        d.classList.toggle('active', i === current);
        d.setAttribute('aria-current', i === current ? 'true' : 'false');
      });
    }

    function go(n) {
      const total = CONFIG.slides.length;
      current = (n + total) % total;
      update();
    }

    // Navigasi
    prevBtn.addEventListener('click', () => go(current - 1));
    nextBtn.addEventListener('click', () => go(current + 1));

    // Keyboard
    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowRight') go(current + 1);
      if (e.key === 'ArrowLeft') go(current - 1);
      if (e.key === ' ' && current === 0) { e.preventDefault(); tryStartMusic(); }
    });

    // Swipe
    slidesEl.addEventListener('pointerdown', (e) => {
      isDragging = true;
      startX = e.clientX;
      deltaX = 0;
      slidesEl.setPointerCapture(e.pointerId);
    });
    slidesEl.addEventListener('pointermove', (e) => {
      if (!isDragging) return;
      deltaX = e.clientX - startX;
    });
    slidesEl.addEventListener('pointerup', () => {
      if (!isDragging) return;
      isDragging = false;
      if (Math.abs(deltaX) > 50) {
        if (deltaX < 0) go(current + 1);
        else go(current - 1);
      }
      deltaX = 0;
    });
    slidesEl.addEventListener('pointercancel', () => isDragging = false);
    slidesEl.addEventListener('pointerleave', () => isDragging = false);
    slidesEl.addEventListener('click', tryStartMusic, { once: true });

    // Musik
    musicToggle.addEventListener('click', () => {
      if (bgm.paused) {
        bgm.play().then(() => { musicOn = true; }).catch(() => { musicOn = false; });
      } else {
        bgm.pause();
        musicOn = false;
      }
      setMusicUI();
    });

    // Error audio
    bgm.addEventListener('error', () => {
      console.error("Gagal memuat file musik. Pastikan 'musik.mp3' ada di folder yang sama.");
    });

    // Init
    buildSlides();
    setMusicUI();
  </script>
</body>
</html>